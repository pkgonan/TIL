# Database Locking

- 데이터 베이스의 DB, 컬럼 등을 동시에 접근하지 못하도록 잠그는 기법


## Why Use?

- 트랜잭션의 결과의 일관성을 보장하기 위해 사용한다.


## How to Use?

- 기본 로킹 규약은 두가지로 구성
   
  1. Shared Lock(공유 락)
  
      Read 연산일 경우, 공유락은 여러개 가능, 공유 락 시 Wirte 불가
  
  2. Exclusive Lock(배제 락)
  
      Write 연산일 경우, 배제락이 걸리면 다른 Read 및 Write 불가


## Exception

- 모든 트랜잭션이 기본 로킹 규약을 지키더라도 잘못된 결과를 얻을 수 있다. 트랜잭션 스케줄의 ㅣ직렬 가능성을 보장하려면 2단계 로킹 규약(2 Phase Lock Protocol)이 필요하다.

  1. 확장 단계 : 트랜잭션이 Lock 연산만 실행할 수 있고, unlock 연산은 실행할 수 없는 단계
  2. 축소 단계 : 트랜잭션이 unlock 연산만 실행할 수 있고, lock 연산은 실행할 수 없는 단계
  
  
- 트랜잭션이 처음에 수행되면 확장 단계로 들어가 lock 연산만 실행할 수 있다.
그러다가 unlock 연산을 실행하면 축소 단계로 들어가 그때부터는 unlock 연산만 실행할 수 있게 된다. 

- 2단계 로킹 규약을 준수하는 트랜잭션은 첫 번째 unlock 연산을 실행하기 전에 필요한 모든 lock 연산을 실행해야 한다. 

- 2단계 로킹 규약을 적용하면 트랜잭션 스케줄의 직렬 가능성을 보장할 수 있다. 하지만 교착 상태(deadlock)가 발생할 수 있어 이에 대한 해결책이 필요하며,
  그 것은 은행원 알고리즘으로 극복한다.
